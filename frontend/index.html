<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hinglish AI Call Assistant</title>
<style>
  body { font-family: Arial; padding: 20px; background: #f5f5f5; }
  #login, #app { max-width: 500px; margin: auto; }
  #login { display: block; }
  #app { display: none; }
  #reply { border: 1px solid #ccc; padding: 10px; height: 250px; overflow-y: auto; background: #fff; }
  button { margin: 5px; padding: 10px 15px; font-size: 16px; }
</style>
</head>
<body>

<div id="login">
  <h2>Enter Password to Unlock</h2>
  <input type="password" id="passwordInput" placeholder="Password" />
  <button onclick="checkPassword()">Unlock</button>
  <p id="loginMsg" style="color:red;"></p>
</div>

<div id="app">
  <h2>Hinglish AI Call Assistant</h2>
  <button id="muteBtn" onclick="toggleMute()">Start Speaking</button>
  <button onclick="refreshSuggestions()">Refresh Suggestions</button>
  <div id="reply"></div>
</div>

<script>
const PASSWORD = "1234"; // change your password
let muted = true;
let lastInput = "";

// ===== PASSWORD =====
function checkPassword() {
  const pw = document.getElementById("passwordInput").value;
  if(pw === PASSWORD){
    document.getElementById("login").style.display = "none";
    document.getElementById("app").style.display = "block";
  } else {
    document.getElementById("loginMsg").innerText = "Wrong password!";
  }
}

// ===== SPEECH TO TEXT =====
let recognition;
if('webkitSpeechRecognition' in window){
  recognition = new webkitSpeechRecognition();
  recognition.continuous = false;
  recognition.interimResults = false;
  recognition.lang = 'en-IN';
  recognition.onresult = function(event){
    lastInput = event.results[0][0].transcript;
    console.log("Heard:", lastInput);
    getAISuggestions(lastInput);
  };
  recognition.onerror = function(event){ console.error(event.error); };
} else {
  alert("Speech recognition not supported in this browser.");
}

function toggleMute(){
  muted = !muted;
  if(!muted){
    document.getElementById("muteBtn").innerText = "Stop Speaking";
    recognition.start();
  } else {
    document.getElementById("muteBtn").innerText = "Start Speaking";
    recognition.stop();
  }
}

// ===== REFRESH =====
function refreshSuggestions(){
  if(lastInput) getAISuggestions(lastInput);
}

// ===== CALL BACKEND =====
async function getAISuggestions(text){
  const replyDiv = document.getElementById("reply");
  replyDiv.innerHTML = "<p>Loading suggestions...</p>";

  try{
    const res = await fetch("http://localhost:3000/get-suggestions", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text })
    });

    const data = await res.json();
    const lines = data.suggestions.split(/\n/).filter(l => l.trim() !== "");
    replyDiv.innerHTML = "";
    lines.forEach(line => {
      const p = document.createElement("p");
      p.innerText = line.trim();
      replyDiv.appendChild(p);
    });

  } catch(err){
    console.error(err);
    replyDiv.innerHTML = "<p style='color:red;'>Error fetching AI suggestions</p>";
  }
}
</script>
</body>
</html>
